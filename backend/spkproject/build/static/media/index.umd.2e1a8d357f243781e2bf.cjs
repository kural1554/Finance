/*! For license information please see index.umd.2e1a8d357f243781e2bf.cjs.LICENSE.txt */
!function(e,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports,require("react"),require("prop-types"),require("@ckeditor/ckeditor5-integrations-common")):"function"===typeof define&&define.amd?define(["exports","react","prop-types","@ckeditor/ckeditor5-integrations-common"],t):t((e="undefined"!==typeof globalThis?globalThis:e||self).CKEDITOR_REACT={},e.React,e.PropTypes,e.CKEDITOR_INTEGRATIONS_COMMON)}(this,(function(e,t,r,o){"use strict";var n=Object.defineProperty,a=(e,t,r)=>((e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!==typeof t?t+"":t,r);const i=class e{constructor(e,t){a(this,"_lifecycle"),a(this,"_element"),a(this,"_releaseLock",null),a(this,"_value",null),a(this,"_afterMountCallbacks",[]),a(this,"_state",{destroyedBeforeInitialization:!1,mountingInProgress:null}),a(this,"release",o.once((()=>{const{_releaseLock:e,_state:t,_element:r,_lifecycle:o}=this;t.mountingInProgress?t.mountingInProgress.then((()=>o.unmount({element:r,mountResult:this.value}))).catch((e=>{console.error("Semaphore unmounting error:",e)})).then(e.resolve).then((()=>{this._value=null})):(t.destroyedBeforeInitialization=!0,e.resolve())}))),this._element=e,this._lifecycle=t,this._lock()}get value(){return this._value}unsafeSetValue(e){this._value=e,this._afterMountCallbacks.forEach((t=>t(e))),this._afterMountCallbacks=[]}runAfterMount(e){const{_value:t,_afterMountCallbacks:r}=this;t?e(t):r.push(e)}_lock(){const{_semaphores:t}=e,{_state:r,_element:n,_lifecycle:a}=this,i=t.get(n)||Promise.resolve(null),s=o.createDefer();this._releaseLock=s;const c=i.then((()=>r.destroyedBeforeInitialization?Promise.resolve(void 0):(r.mountingInProgress=a.mount().then((e=>(e&&this.unsafeSetValue(e),e))),r.mountingInProgress))).then((async e=>{e&&a.afterMount&&await a.afterMount({element:n,mountResult:e})})).then((()=>s.promise)).catch((e=>{console.error("Semaphore mounting error:",e)})).then((()=>{t.get(n)===c&&t.delete(n)}));t.set(n,c)}};a(i,"_semaphores",new Map);let s=i;const c="$__CKEditorReactContextMetadata";const u=e=>{const r=t.useRef();return r.current=e,t.useCallback(((...e)=>r.current(...e)),[])},d=({currentContextWatchdog:e,onChangeInitializedEditors:r})=>{const o=u(r||(()=>{}));t.useEffect((()=>{var t;if("initialized"!==e.status)return;const{watchdog:r}=e,n=null==(t=null==r?void 0:r.context)?void 0:t.editors;if(!n)return;const a=()=>[...n].reduce(((e,t)=>{var r;if("ready"!==t.state)return e;const o=t.config.get(c);return e[null!=(r=null==o?void 0:o.name)?r:t.id]={instance:t,metadata:o},e}),Object.create({})),i=()=>{o(a(),r)},s=(e,t)=>{t.once("ready",i,{priority:"lowest"}),t.once("destroy",i,{priority:"lowest"})};return n.on("add",s),()=>{n.off("add",s)}}),[e])},l=t.createContext(null),h=e=>t=>(e=>!!e&&"object"===typeof e&&"status"in e&&["initializing","initialized","error"].includes(e.status))(t)&&t.status===e,f=h("initializing"),m=e=>h("initialized")(e)&&"ready"===e.watchdog.state,p="Lock from React integration (@ckeditor/ckeditor5-react)";class g extends t.Component{constructor(e){super(e),a(this,"domContainer",t.createRef()),a(this,"editorSemaphore",null),this._checkVersion()}_checkVersion(){const{CKEDITOR_VERSION:e}=window;if(!e)return console.warn('Cannot find the "CKEDITOR_VERSION" in the "window" scope.');const[t]=e.split(".").map(Number);t>=42||e.startsWith("0.0.0")||console.warn("The <CKEditor> component requires using CKEditor 5 in version 42+ or nightly build.")}get _semaphoreValue(){const{editorSemaphore:e}=this;return e?e.value:null}get watchdog(){const{_semaphoreValue:e}=this;return e?e.watchdog:null}get editor(){const{_semaphoreValue:e}=this;return e?e.instance:null}shouldComponentUpdate(e){const{props:t,editorSemaphore:r}=this;return e.id!==t.id||(e.disableWatchdog!==t.disableWatchdog||(r&&(r.runAfterMount((({instance:r})=>{this._shouldUpdateEditorData(t,e,r)&&r.data.set(e.data)})),"disabled"in e&&r.runAfterMount((({instance:t})=>{e.disabled?t.enableReadOnlyMode(p):t.disableReadOnlyMode(p)}))),!1))}componentDidMount(){f(this.context)||this._initLifeCycleSemaphore()}componentDidUpdate(){f(this.context)||this._initLifeCycleSemaphore()}componentWillUnmount(){this._unlockLifeCycleSemaphore()}_unlockLifeCycleSemaphore(){this.editorSemaphore&&(this.editorSemaphore.release(),this.editorSemaphore=null)}_initLifeCycleSemaphore(){this._unlockLifeCycleSemaphore(),this.editorSemaphore=new s(this.domContainer.current,{mount:async()=>this._initializeEditor(),afterMount:({mountResult:e})=>{const{onReady:t}=this.props;t&&null!==this.domContainer.current&&t(e.instance)},unmount:async({element:e,mountResult:t})=>{const{onAfterDestroy:r}=this.props;try{await this._destroyEditor(t),e.innerHTML=""}finally{r&&r(t.instance)}}})}render(){return t.createElement("div",{ref:this.domContainer})}async _initializeEditor(){if(this.props.disableWatchdog){return{instance:await this._createEditor(this.domContainer.current,this._getConfig()),watchdog:null}}const e=(()=>m(this.context)?new y(this.context.watchdog):new this.props.editor.EditorWatchdog(this.props.editor,this.props.watchdogConfig))(),t={current:0};return e.setCreator((async(r,o)=>{var n;const{editorSemaphore:a}=this,{onAfterDestroy:i}=this.props;t.current>0&&i&&(null==(n=null==a?void 0:a.value)?void 0:n.instance)&&i(a.value.instance);const s=await this._createEditor(r,o);return a&&t.current>0&&(a.unsafeSetValue({instance:s,watchdog:e}),setTimeout((()=>{this.props.onReady&&this.props.onReady(e.editor)}))),t.current++,s})),e.on("error",((e,{error:t,causesRestart:r})=>{(this.props.onError||console.error)(t,{phase:"runtime",willEditorRestart:r})})),await e.create(this.domContainer.current,this._getConfig()).catch((e=>{(this.props.onError||console.error)(e,{phase:"initialization",willEditorRestart:!1})})),{watchdog:e,instance:e.editor}}_createEditor(e,t){const{contextItemMetadata:r}=this.props;return r&&(t=function(e,t){return{...t,[c]:e}}(r,t)),this.props.editor.create(e,t).then((e=>{"disabled"in this.props&&this.props.disabled&&e.enableReadOnlyMode(p);const t=e.model.document,r=e.editing.view.document;return t.on("change:data",(t=>{this.props.onChange&&this.props.onChange(t,e)})),r.on("focus",(t=>{this.props.onFocus&&this.props.onFocus(t,e)})),r.on("blur",(t=>{this.props.onBlur&&this.props.onBlur(t,e)})),e}))}async _destroyEditor(e){const{watchdog:t,instance:r}=e;return new Promise(((e,o)=>{setTimeout((async()=>{try{if(t)return await t.destroy(),e();if(r)return await r.destroy(),e();e()}catch(n){console.error(n),o(n)}}))}))}_shouldUpdateEditorData(e,t,r){return e.data!==t.data&&r.data.get()!==t.data}_getConfig(){const e=this.props.config||{};return this.props.data&&e.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `content` property. The config value takes precedence over `content` property and will be used when both are specified."),{...e,initialData:e.initialData||this.props.data||""}}}a(g,"contextType",l),a(g,"propTypes",{editor:r.func.isRequired,data:r.string,config:r.object,disableWatchdog:r.bool,watchdogConfig:r.object,onChange:r.func,onReady:r.func,onFocus:r.func,onBlur:r.func,onError:r.func,disabled:r.bool,id:r.any});class y{constructor(e){a(this,"_contextWatchdog"),a(this,"_id"),a(this,"_creator"),this._contextWatchdog=e,this._id=o.uid()}setCreator(e){this._creator=e}create(e,t){return this._contextWatchdog.add({sourceElementOrData:e,config:t,creator:this._creator,id:this._id,type:"editor"})}on(e,t){this._contextWatchdog.on("itemError",((e,{itemId:r,error:o})=>{r===this._id&&t(null,{error:o,causesRestart:void 0})}))}destroy(){return"ready"===this._contextWatchdog.state?this._contextWatchdog.remove(this._id):Promise.resolve()}get editor(){return this._contextWatchdog.getItem(this._id)}}function b(...e){return t=>{e.forEach((e=>{"function"===typeof e?e(t):null!=e&&(e.current=t)}))}}const w=(e,r)=>{const n=t.useRef(null);o.shallowCompareArrays(n.current,r)||(n.current=[...r],e())},E=(e,t,r)=>{w((()=>{e&&e.runAfterMount(t)}),[e,...r])},R="Lock from React integration (@ckeditor/ckeditor5-react)",C=t.memo(t.forwardRef((({id:e,semaphore:r,rootName:o},n)=>{const a=t.useRef(null);return t.useEffect((()=>{let e,t;return r.runAfterMount((({instance:r})=>{if(!a.current)return;t=r;const{ui:n,model:i}=t,s=i.document.getRoot(o);s&&t.ui.getEditableElement(o)&&t.detachEditable(s),e=n.view.createEditable(o,a.current),n.addEditable(e),r.editing.view.forceRender()})),()=>{if(t&&"destroyed"!==t.state&&a.current){const e=t.model.document.getRoot(o);e&&t.detachEditable(e)}}}),[r.revision]),t.createElement("div",{key:r.revision,id:e,ref:b(n,a)})})));C.displayName="EditorEditable";const v=t.forwardRef((({editor:e},r)=>{const o=t.useRef(null);return t.useEffect((()=>{const t=o.current;if(!e||!t)return;const r=e.ui.view.toolbar.element;return t.appendChild(r),()=>{t.contains(r)&&t.removeChild(r)}}),[e&&e.id]),t.createElement("div",{ref:b(o,r)})}));v.displayName="EditorToolbarWrapper";const _=e=>{const[r,n]=t.useState({status:"idle"}),a=(()=>{const e=t.useRef(!1);return t.useEffect((()=>(e.current=!1,()=>{e.current=!0})),[]),e})(),i=t.useRef(null);return[u((async(...t)=>{if(a.current||o.isSSR())return null;const s=o.uid();i.current=s;try{"loading"!==r.status&&n({status:"loading"});const o=await e(...t);return a.current||i.current!==s||n({status:"success",data:o}),o}catch(c){console.error(c),a.current||i.current!==s||n({status:"error",error:c})}return null})),r]};function k(e){const t=((e,t)=>{const[r,o]=_(e);return w(r,t),"idle"===o.status?{status:"loading"}:o})((async()=>o.loadCKEditorCloud(e)),[JSON.stringify(e)]);return"success"===t.status?{...t.data,status:"success"}:t}Object.defineProperty(e,"loadCKEditorCloud",{enumerable:!0,get:()=>o.loadCKEditorCloud}),e.CKEditor=g,e.CKEditorContext=e=>{const{id:r,context:n,watchdogConfig:a,children:i,config:s,onReady:c,contextWatchdog:u,isLayoutReady:h=!0,onChangeInitializedEditors:f,onError:m=(e,t)=>console.error(e,t)}=e,p=(()=>{const e=t.useRef(!1);return t.useEffect((()=>(e.current=!0,()=>{e.current=!1})),[]),e})(),g=t.useRef(null),[y,b]=t.useState({status:"initializing"});function w(e){return g.current===e&&p.current}return t.useEffect((()=>{h?function(){const e=(g.current=o.uid(),g.current),t=new u(n,a);t.on("error",((t,r)=>{w(e)&&m(r.error,{phase:"runtime",willContextRestart:r.causesRestart})})),t.on("stateChange",(()=>{c&&"ready"===t.state&&w(e)&&c(t.context,t)})),t.create(s).then((()=>{w(e)?b({status:"initialized",watchdog:t}):t.destroy()})).catch((t=>{w(e)&&(m(t,{phase:"initialization",willContextRestart:!1}),b({status:"error",error:t}))}))}():b({status:"initializing"})}),[r,h]),t.useEffect((()=>()=>{"initialized"===y.status&&y.watchdog.destroy()}),[y]),d({currentContextWatchdog:y,onChangeInitializedEditors:f}),t.createElement(l.Provider,{value:y},i)},e.useCKEditorCloud=k,e.useMultiRootEditor=e=>{const r=t.useRef(e.semaphoreElement||null),n=(()=>{const e=t.useRef(null),[r,o]=t.useState((()=>Date.now())),n=()=>{o(Date.now())},a=(t=!0)=>{e.current&&(e.current.release(),e.current=null),t&&o(Date.now())},i=t=>{e.current&&e.current.runAfterMount(t)};return{get current(){return e.current},revision:r,createAttributeRef:t=>({get current(){return e.current&&e.current.value?e.current.value[t]:null}}),unsafeSetValue:t=>{var r;null==(r=e.current)||r.unsafeSetValue(t),n()},release:a,replace:t=>{a(!1),e.current=t(),n(),i(n)},runAfterMount:i}})(),a={watchdog:n.createAttributeRef("watchdog"),instance:n.createAttributeRef("instance")},i=t.useContext(l),[c,d]=t.useState((()=>Object.keys(e.data))),[h,f]=t.useState({...e.data}),[p,g]=t.useState({...e.rootsAttributes}),b=t.useRef(!0);t.useEffect((()=>{const t=r.current;if((!i||m(i))&&t&&!1!==e.isLayoutReady)return n.replace((()=>new s(t,{mount:D,afterMount:({mountResult:t})=>{const{onReady:o}=e;o&&null!==r.current&&o(t.instance)},unmount:async({element:t,mountResult:r})=>{const{onAfterDestroy:o}=e;try{await A(r),t.innerHTML=""}finally{o&&o(r.instance)}}}))),()=>{(()=>{const e=a.instance.current;if(!e)return;Object.values(e.ui.view.editables).forEach((t=>{t.name&&!e.editing.view.getDomRoot(t.name)&&e.editing.view.attachDomRoot(document.createElement("div"),t.name)}))})(),n.release(!1)}}),[e.id,e.isLayoutReady,null==i?void 0:i.status]);const w=()=>{const t=e.config||{};return e.data&&t.initialData&&console.warn("Editor data should be provided either using `config.initialData` or `data` property. The config value takes precedence over `data` property and will be used when both are specified."),{...t,rootsAttributes:p}},_=u(((t,r)=>{const o=t.model.document;if(!e.disableTwoWayDataBinding){const e={},r={};o.differ.getChanges().forEach((r=>{let o;if(o="insert"==r.type||"remove"==r.type?r.position.root:r.range.root,!o.isAttached())return;const{rootName:n}=o;e[n]=t.getData({rootName:n})})),o.differ.getChangedRoots().forEach((o=>{if(o.state)return void(void 0!==e[o.name]&&delete e[o.name]);const n=o.name;r[n]=t.getRootAttributes(n)})),Object.keys(e).length&&f((t=>({...t,...e}))),Object.keys(r).length&&g((e=>({...e,...r})))}e.onChange&&e.onChange(r,t)})),k=u(((t,r,n)=>{const a=n.rootName;e.disableTwoWayDataBinding||(f((e=>({...e,[a]:t.getData({rootName:a})}))),g((e=>({...e,[a]:t.getRootAttributes(a)})))),d((e=>o.uniq([...e,n.rootName])))})),O=u(((t,r,o)=>{const n=o.rootName;e.disableTwoWayDataBinding||(f((e=>{const{[n]:t,...r}=e;return{...r}})),g((e=>{const{[n]:t,...r}=e;return{...r}}))),d((e=>e.filter((e=>e!==n))))})),S=u(((t,r)=>(o.overwriteObject({...e.rootsAttributes},p),o.overwriteObject({...e.data},h),o.overwriteArray(Object.keys(e.data),c),e.editor.create(t,r).then((t=>{const r=t.getFullData();o.overwriteObject({...r},h),o.overwriteObject({...t.getRootsAttributes()},p),o.overwriteArray(Object.keys(r),c),e.disabled&&t.enableReadOnlyMode(R);const n=t.model.document,a=t.editing.view.document;return n.on("change:data",(e=>_(t,e))),t.on("addRoot",((e,r)=>k(t,e,r))),t.on("detachRoot",((e,r)=>O(t,e,r))),a.on("focus",(r=>{e.onFocus&&e.onFocus(r,t)})),a.on("blur",(r=>{e.onBlur&&e.onBlur(r,t)})),t}))))),A=e=>{const{watchdog:t,instance:r}=e;return new Promise(((e,o)=>{setTimeout((async()=>{try{if(t)return await t.destroy(),e();if(r)return await r.destroy(),e();e()}catch(n){console.error(n),o(n)}}))}))},D=async()=>{if(e.disableWatchdog){return{instance:await S(e.data,w()),watchdog:null}}const t=m(i)?new y(i.watchdog):new e.editor.EditorWatchdog(e.editor,e.watchdogConfig),r={current:0};return t.setCreator((async(o,i)=>{const{onAfterDestroy:s}=e;r.current>0&&s&&a.instance.current&&s(a.instance.current);const c=await S(o,i);return r.current>0&&(n.unsafeSetValue({instance:c,watchdog:t}),setTimeout((()=>{e.onReady&&e.onReady(t.editor)}))),r.current++,c})),t.on("error",((t,{error:r,causesRestart:o})=>{(e.onError||console.error)(r,{phase:"runtime",willEditorRestart:o})})),await t.create(h,w()).catch((t=>{throw(e.onError||console.error)(t,{phase:"initialization",willEditorRestart:!1}),t})),{watchdog:t,instance:t.editor}},M=t.useCallback((e=>{n.runAfterMount((()=>{b.current=!0,f(e)}))}),[f]),x=t.useCallback((e=>{n.runAfterMount((()=>{b.current=!0,g(e)}))}),[g]),T=t.createElement(v,{ref:r,editor:a.instance.current});E(n.current,(({instance:t})=>{e.disabled?t.enableReadOnlyMode(R):t.disableReadOnlyMode(R)}),[e.disabled]),E(n.current,(({instance:e})=>{if(b.current){b.current=!1;const t=Object.keys(h),r=Object.keys(p);if(!t.every((e=>r.includes(e))))throw console.error("`data` and `attributes` objects must have the same keys (roots)."),new Error("`data` and `attributes` objects must have the same keys (roots).");const o=e.getFullData(),n=e.getRootsAttributes(),{addedKeys:a,removedKeys:i}=((e,t)=>{const r=Object.keys(e),o=Object.keys(t);return{addedKeys:o.filter((e=>!r.includes(e))),removedKeys:r.filter((e=>!o.includes(e)))}})(o,h||{}),s=t.some((e=>void 0!==o[e]&&JSON.stringify(o[e])!==JSON.stringify(h[e]))),c=r.filter((e=>JSON.stringify(n[e])!==JSON.stringify(p[e]))),u=t=>{t.forEach((t=>{e.addRoot(t,{data:h[t]||"",attributes:(null==p?void 0:p[t])||{},isUndoable:!0})}))},d=t=>{t.forEach((t=>{e.detachRoot(t,!0)}))},l=()=>{e.data.set(h,{suppressErrorInCollaboration:!0})},f=(t,r)=>{r.forEach((r=>{Object.keys(p[r]).forEach((t=>{e.registerRootAttribute(t)})),t.clearAttributes(e.model.document.getRoot(r)),t.setAttributes(p[r],e.model.document.getRoot(r))}))};setTimeout((()=>{e.model.change((e=>{u(a),d(i),s&&l(),c.length&&f(e,c)}))}))}}),[h,p]);const j=c.map((e=>t.createElement(C,{key:e,id:e,rootName:e,semaphore:n})));return{editor:a.instance.current,editableElements:j,toolbarElement:T,data:h,setData:M,attributes:p,setAttributes:x}},e.withCKEditorCloud=e=>r=>{const o=o=>{var n,a;const i=k(e.cloud);switch(i.status){case"error":return e.renderError?e.renderError(i.error):"Unable to load CKEditor Cloud data!";case"success":return t.createElement(r,{...o,cloud:i});default:return null!=(a=null==(n=e.renderLoader)?void 0:n.call(e))?a:null}};return o.displayName="ComponentWithCKEditorCloud",o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));